---
title: Using AWS Lambda and SQS to perform mass and distributed asynchronous updates on DynamoDB Tables
categories: '#AWS #SQS #DynamoDB #NoSQL'
keywords: aws,dynamodb,aws lambda,sqs,dynamodb table,nosql,update where nosql,update where dynamodb,mass update dynamodb,cloud
date: '2019-11-16T22:12:03.284Z'
length: 8 minutes
---

`UPDATE X WHERE Y;` is non-trivial task to do in NoSQL landscape as opposed to other SQL-based databases. In SQL it's just one operation while on NoSQL you have to run `PUT` operation against each record.

That's not only time consuming task because we have to run N operations but it's also taking a lot of write throughput if performed all-at-once so might be expensive. So, we need to gradually perform the update with limited speed. Moreover, throttling can also prevent from some updates happening at all so you may end up with data inconsistencies.

Basically, there are just two requirements that need to be met:

1. Make sure all records were updated.
2. Make sure it was cost effective.

Let's go through of some possible examples how it can be done.

## One big synchronous update and why it's bad

First thing that might go to your head is just perform `query` operation to get all the desired records and run `update` inside the same function on all fetched rows.

<br />

![Simple NoSQL update design](./1.png 'Simple NoSQL update design')

<br />

While this solution might be perfectly fine for small operations, once you hit bigger number of rows this solution will might not only timeout but also hit the WCU limit of your table effectively making your data corrupted.

## Decouple and parallelize updates

<br />

![Simple NoSQL update design](./2.png 'Simple NoSQL update design')

<br />

- Hit WCU limit
- Get might still timeout.

## Update while streaming
